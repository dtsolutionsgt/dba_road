USE [ROADSAP_QAS]
GO

/****** Object:  StoredProcedure [dbo].[SP_REPORTE_VENTAS_II]    Script Date: 11/10/2022 17:44:25 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO


-- =============================================
-- Author:		Carolina Fuentes
-- Create date: 11-10-2022
-- Description:	Procedimiento para generar reporte de Ventas
-- =============================================
CREATE PROCEDURE [dbo].[SP_REPORTE_VENTAS_II]
	@FechaIni AS DATETIME,
	@FechaFin AS DATETIME,
	@Sucursal AS NVARCHAR(15)
AS
BEGIN
		-- SET NOCOUNT ON added to prevent extra result sets from
		-- interfering with SELECT statements.
	SET NOCOUNT ON;

	SELECT  D_FACTURA.STATCOM, ISNULL(VENDEDORES.BODEGA,'') AS OFI_VENTAS, D_FACTURA.FECHA, 
	D_FACTURA.SERIE + RIGHT('000000' + CONVERT(nvarchar(6), D_FACTURA.CORELATIVO), 6) AS COREL, D_FACTURA.COREL AS COREL1, 
	RIGHT ('0000000000' + D_FACTURA.CLIENTE,10) AS CLIENTE, 
	RIGHT ('0000000000' + D_FACTURA.CLIENTE,10) AS CLIENTE2, D_FACTURA.VENDEDOR, D_FACTURA.SUPERVISOR, D_FACTURA.AYUDANTE, 
	D_FACTURAD.PRODUCTO, 
	CASE WHEN P_PRODUCTO.VENTA_POR_PESO = 1 AND P_PRODUCTO.ES_PROD_BARRA = 0 THEN ISNULL(D_FACTURAD_LOTES.PESO, D_FACTURAD.PESO)
	ELSE ISNULL(D_FACTURAD_LOTES.CANTIDAD, D_FACTURAD.CANT) END AS CANT, CASE WHEN P_PRODUCTO.VENTA_POR_PESO = 1 
	AND P_PRODUCTO.ES_PROD_BARRA = 0 THEN ISNULL(D_FACTURAD_LOTES.PESO, D_FACTURAD.PESO)
	ELSE ISNULL(D_FACTURAD_LOTES.CANTIDAD, D_FACTURAD.CANT) END AS CANT2, 
	ISNULL(D_FACTURAD_LOTES.LOTE, N'') AS LOTE, D_FACTURAD.PRECIODOC, D_FACTURAD.PRODUCTO AS PRODUCTO2, '' AS BARRA2, 
	D_FACTURAD.PESO, D_FACTURA.RUTA, ISNULL(VENDEDORES.SUBBODEGA,'') AS GRUPO_VEND, ISNULL(VENDEDORES.NIVEL,0) AS NIVEL, 
	'' AS MOTIVO, 0 AS BONIFICADO, 
	CONVERT(NVARCHAR(15),CONVERT(FLOAT,D_FACTURAD.VAL2)) AS POSICION, 0 AS PADRE, CONVERT(INT, D_FACTURA.VEHICULO) AS CREDITO, '3000' AS SOCIEDAD, 
	D_DEPOS.BANCO AS CUENTA, ROUND(D_FACTURA.TOTAL, 2) AS TOTAL, D_FACTURA.REFERENCIA, D_FACTURA.SERIE, VENDEDORES.NOMBRE, D_FACTURA.CODIGOLIQUIDACION
	FROM      D_FACTURA INNER JOIN
	D_FACTURAD ON D_FACTURA.COREL = D_FACTURAD.COREL INNER JOIN
	P_VENDEDOR AS VENDEDORES ON D_FACTURA.VENDEDOR = VENDEDORES.CODIGO  RIGHT OUTER JOIN
	D_FACTURAD_LOTES ON D_FACTURAD.COREL = D_FACTURAD_LOTES.COREL AND 
	D_FACTURAD.PRODUCTO = D_FACTURAD_LOTES.PRODUCTO INNER JOIN
	D_DEPOSD ON D_DEPOSD.DOCCOREL = D_FACTURA.COREL INNER JOIN
	D_DEPOS ON D_DEPOSD.COREL = D_DEPOS.COREL INNER JOIN P_PRODUCTO ON 
	P_PRODUCTO.CODIGO = D_FACTURAD.PRODUCTO
	WHERE     (D_FACTURA.ANULADO = N'N') AND D_FACTURA.FECHA BETWEEN @FechaIni and @FechaFin AND  VENDEDORES.BODEGA = @Sucursal 
	UNION
	SELECT      D_FACTURA.STATCOM, ISNULL(VENDEDORES.BODEGA,'') AS OFI_VENTAS, D_FACTURA.FECHA, 
	D_FACTURA.SERIE + RIGHT('000000' + CONVERT(nvarchar(6), D_FACTURA.CORELATIVO), 6) AS COREL, D_FACTURA.COREL AS COREL1, 
	RIGHT ('0000000000' + D_FACTURA.CLIENTE,10) AS CLIENTE, 
	RIGHT ('0000000000' + D_FACTURA.CLIENTE,10) AS CLIENTE2, D_FACTURA.VENDEDOR, D_FACTURA.SUPERVISOR, D_FACTURA.AYUDANTE, 
	D_FACTURAD.PRODUCTO, 
	CASE WHEN P_PRODUCTO.VENTA_POR_PESO = 1 AND P_PRODUCTO.ES_PROD_BARRA = 0 THEN ISNULL(D_FACTURAD_LOTES.PESO, D_FACTURAD.PESO)
	ELSE ISNULL(D_FACTURAD_LOTES.CANTIDAD, D_FACTURAD.CANT) END AS CANT, CASE WHEN P_PRODUCTO.VENTA_POR_PESO = 1 
	AND P_PRODUCTO.ES_PROD_BARRA = 0 THEN ISNULL(D_FACTURAD_LOTES.PESO, D_FACTURAD.PESO)
		ELSE ISNULL(D_FACTURAD_LOTES.CANTIDAD, D_FACTURAD.CANT) END AS CANT2, 
	ISNULL(D_FACTURAD_LOTES.LOTE, N'') AS LOTE, D_FACTURAD.PRECIODOC, D_FACTURAD.PRODUCTO AS PRODUCTO2, '' AS BARRA2, 
	D_FACTURAD.PESO, D_FACTURA.RUTA, ISNULL(VENDEDORES.SUBBODEGA,'') AS GRUPO_VEND, ISNULL(VENDEDORES.NIVEL,0) AS NIVEL, 
	'' AS MOTIVO, 0 AS BONIFICADO, 
	CONVERT(NVARCHAR(15),CONVERT(FLOAT,D_FACTURAD.VAL2)) AS POSICION, 0 AS PADRE, CONVERT(INT, D_FACTURA.VEHICULO) AS CREDITO, '3000' AS SOCIEDAD, '' AS CUENTA, 
	ROUND(D_FACTURA.TOTAL, 2) AS TOTAL, D_FACTURA.REFERENCIA, D_FACTURA.SERIE, VENDEDORES.NOMBRE, D_FACTURA.CODIGOLIQUIDACION
	FROM         D_FACTURA INNER JOIN
	D_FACTURAD ON D_FACTURA.COREL = D_FACTURAD.COREL INNER JOIN
		P_VENDEDOR AS VENDEDORES ON D_FACTURA.VENDEDOR = VENDEDORES.CODIGO RIGHT OUTER JOIN
	D_FACTURAD_LOTES ON D_FACTURAD.COREL = D_FACTURAD_LOTES.COREL AND 
	D_FACTURAD.PRODUCTO = D_FACTURAD_LOTES.PRODUCTO INNER JOIN P_PRODUCTO ON 
	P_PRODUCTO.CODIGO = D_FACTURAD.PRODUCTO
	WHERE     (D_FACTURA.ANULADO = N'N')  AND CONVERT(INT, D_FACTURA.VEHICULO) = 1 
	AND D_FACTURA.FECHA BETWEEN @FechaIni and @FechaFin AND  VENDEDORES.BODEGA = @Sucursal 
	UNION
	SELECT      D_FACTURA.STATCOM, ISNULL(VENDEDORES.BODEGA,'') AS OFI_VENTAS, D_FACTURA.FECHA, 
	D_FACTURA.SERIE + RIGHT('000000' + CONVERT(nvarchar(6), D_FACTURA.CORELATIVO), 6) AS COREL, D_FACTURA.COREL AS COREL1, 
	RIGHT ('0000000000' + D_FACTURA.CLIENTE,10) AS CLIENTE, 
	RIGHT ('0000000000' + D_FACTURA.CLIENTE,10) AS CLIENTE2, D_FACTURA.VENDEDOR, D_FACTURA.SUPERVISOR, D_FACTURA.AYUDANTE, 
	D_FACTURAD_1.PRODUCTO, 
	D_STOCKB_DEV.PESO AS CANT, 1 AS CANT2, '' AS LOTE, D_FACTURAD_1.PRECIODOC, D_FACTURAD_1.PRODUCTO AS PRODUCTO2, 
	D_STOCKB_DEV.BARRA AS BARRA2, D_STOCKB_DEV.PESO, D_FACTURA.RUTA, ISNULL(VENDEDORES.SUBBODEGA,'') AS GRUPO_VEND, 
	ISNULL(VENDEDORES.NIVEL,0) AS NIVEL, '' AS MOTIVO, 0 AS BONIFICADO, CONVERT(NVARCHAR(15),CONVERT(FLOAT,D_FACTURAD_1.VAL2))  AS POSICION, 0 AS PADRE, 
	CONVERT(INT, D_FACTURA.VEHICULO) AS CREDITO, '3000' AS SOCIEDAD, 
	D_DEPOS.BANCO AS CUENTA, ROUND(D_FACTURA.TOTAL, 2) AS TOTAL, D_FACTURA.REFERENCIA, D_FACTURA.SERIE, VENDEDORES.NOMBRE, D_FACTURA.CODIGOLIQUIDACION
	FROM         D_FACTURA AS D_FACTURA INNER JOIN
	D_FACTURAD AS D_FACTURAD_1 ON D_FACTURA.COREL = D_FACTURAD_1.COREL INNER JOIN
		P_VENDEDOR AS VENDEDORES ON D_FACTURA.VENDEDOR = VENDEDORES.CODIGO RIGHT OUTER JOIN
	D_STOCKB_DEV ON D_FACTURAD_1.PRODUCTO = D_STOCKB_DEV.CODIGO AND D_FACTURAD_1.COREL = D_STOCKB_DEV.COREL INNER JOIN
	D_DEPOSD ON D_DEPOSD.DOCCOREL = D_FACTURA.COREL INNER JOIN
	D_DEPOS ON D_DEPOSD.COREL = D_DEPOS.COREL
	WHERE     (D_FACTURA.ANULADO = N'N')  AND D_FACTURA.FECHA BETWEEN @FechaIni and @FechaFin AND  VENDEDORES.BODEGA = @Sucursal 
	UNION
	SELECT      D_FACTURA.STATCOM, ISNULL(VENDEDORES.BODEGA,'') AS OFI_VENTAS, D_FACTURA.FECHA, 
	D_FACTURA.SERIE + RIGHT('000000' + CONVERT(nvarchar(6), D_FACTURA.CORELATIVO), 6) AS COREL, D_FACTURA.COREL AS COREL1, 
	RIGHT ('0000000000' + D_FACTURA.CLIENTE,10) AS CLIENTE, 
	RIGHT ('0000000000' + D_FACTURA.CLIENTE,10) AS CLIENTE2, D_FACTURA.VENDEDOR, D_FACTURA.SUPERVISOR, D_FACTURA.AYUDANTE, 
	D_FACTURAD_1.PRODUCTO, 
	D_STOCKB_DEV.PESO AS CANT, 1 AS CANT2, '' AS LOTE, D_FACTURAD_1.PRECIODOC, D_FACTURAD_1.PRODUCTO AS PRODUCTO2, 
	D_STOCKB_DEV.BARRA AS BARRA2, D_STOCKB_DEV.PESO, D_FACTURA.RUTA, ISNULL(VENDEDORES.SUBBODEGA,'') AS GRUPO_VEND, 
	ISNULL(VENDEDORES.NIVEL,0) AS NIVEL, '' AS MOTIVO, 0 AS BONIFICADO, CONVERT(NVARCHAR(15),CONVERT(FLOAT,D_FACTURAD_1.VAL2))  AS POSICION, 0 AS PADRE, 
	CONVERT(INT, D_FACTURA.VEHICULO) AS CREDITO, '3000' AS SOCIEDAD, 
	'' AS CUENTA, ROUND(D_FACTURA.TOTAL, 2) AS TOTAL, D_FACTURA.REFERENCIA, D_FACTURA.SERIE, VENDEDORES.NOMBRE, D_FACTURA.CODIGOLIQUIDACION
	FROM         D_FACTURA AS D_FACTURA INNER JOIN
	D_FACTURAD AS D_FACTURAD_1 ON D_FACTURA.COREL = D_FACTURAD_1.COREL INNER JOIN
		P_VENDEDOR AS VENDEDORES ON D_FACTURA.VENDEDOR = VENDEDORES.CODIGO RIGHT OUTER JOIN
	D_STOCKB_DEV ON D_FACTURAD_1.PRODUCTO = D_STOCKB_DEV.CODIGO AND D_FACTURAD_1.COREL = D_STOCKB_DEV.COREL 
	WHERE     (D_FACTURA.ANULADO = N'N')  AND CONVERT(INT, D_FACTURA.VEHICULO) = 1
	AND D_FACTURA.FECHA BETWEEN @FechaIni and @FechaFin AND  VENDEDORES.BODEGA = @Sucursal 
	UNION
	SELECT      D_FACTURA.STATCOM, ISNULL(VENDEDORES.BODEGA,'') AS OFI_VENTAS, D_FACTURA.FECHA, 
	D_FACTURA.SERIE + RIGHT('000000' + CONVERT(nvarchar(6), D_FACTURA.CORELATIVO), 6) AS COREL, D_FACTURA.COREL AS COREL1, 
	RIGHT ('0000000000' + D_FACTURA.CLIENTE,10) AS CLIENTE, 
	RIGHT ('0000000000' + D_FACTURA.CLIENTE,10) AS CLIENTE2, D_FACTURA.VENDEDOR, D_FACTURA.SUPERVISOR, D_FACTURA.AYUDANTE, 
	D_BONIF_LOTES.PRODUCTO, 
	CASE WHEN P_PRODUCTO.VENTA_POR_PESO = 1 AND P_PRODUCTO.ES_PROD_BARRA = 0 THEN D_BONIF_LOTES.PESO
	ELSE D_BONIF_LOTES.CANT END AS CANT, 
	CASE WHEN P_PRODUCTO.VENTA_POR_PESO = 1 AND P_PRODUCTO.ES_PROD_BARRA = 0 THEN D_BONIF_LOTES.PESO
	ELSE D_BONIF_LOTES.CANT END AS CANT2, D_BONIF_LOTES.LOTE, 0 AS BONIFICADO, 
	D_BONIF_LOTES.PRODUCTO AS PRODUCTO2, '' AS BARRA2, D_BONIF_LOTES.PESO, D_FACTURA.RUTA, 
	ISNULL(VENDEDORES.SUBBODEGA,'') AS GRUPO_VEND, ISNULL(VENDEDORES.NIVEL,0) AS NIVEL, '' AS MOTIVO, 1 AS Expr1, 
	D_REL_PROD_BON.CONSECUTIVO AS POSICION, 
	D_REL_PROD_BON.CONSECUTIVO AS PADRE,CONVERT(INT, D_FACTURA.VEHICULO) AS CREDITO, '3000' AS SOCIEDAD, 
	D_DEPOS.BANCO AS CUENTA, ROUND(D_FACTURA.TOTAL, 2) AS TOTAL, D_FACTURA.REFERENCIA, D_FACTURA.SERIE, VENDEDORES.NOMBRE, D_FACTURA.CODIGOLIQUIDACION
	FROM         D_FACTURA AS D_FACTURA INNER JOIN
		P_VENDEDOR AS VENDEDORES ON D_FACTURA.VENDEDOR = VENDEDORES.CODIGO INNER JOIN
	D_REL_PROD_BON ON D_FACTURA.COREL = D_REL_PROD_BON.COREL INNER JOIN
	D_BONIF_LOTES ON D_REL_PROD_BON.COREL = D_BONIF_LOTES.COREL AND 
	D_REL_PROD_BON.BONIFICADO = D_BONIF_LOTES.PRODUCTO  INNER JOIN P_PRODUCTO ON 
	P_PRODUCTO.CODIGO = D_BONIF_LOTES.PRODUCTO INNER JOIN
	D_DEPOSD ON D_DEPOSD.DOCCOREL = D_FACTURA.COREL INNER JOIN
	D_DEPOS ON D_DEPOSD.COREL = D_DEPOS.COREL
	WHERE     (D_FACTURA.ANULADO = N'N') AND D_FACTURA.FECHA BETWEEN @FechaIni and @FechaFin AND  VENDEDORES.BODEGA = @Sucursal 
	UNION
	SELECT      D_FACTURA.STATCOM, ISNULL(VENDEDORES.BODEGA,'') AS OFI_VENTAS, D_FACTURA.FECHA, 
	D_FACTURA.SERIE + RIGHT('000000' + CONVERT(nvarchar(6), D_FACTURA.CORELATIVO), 6) AS COREL, D_FACTURA.COREL AS COREL1, 
	RIGHT ('0000000000' + D_FACTURA.CLIENTE,10) AS CLIENTE, 
	RIGHT ('0000000000' + D_FACTURA.CLIENTE,10) AS CLIENTE2, D_FACTURA.VENDEDOR, D_FACTURA.SUPERVISOR, D_FACTURA.AYUDANTE,
	 D_BONIF_LOTES.PRODUCTO, 
	CASE WHEN P_PRODUCTO.VENTA_POR_PESO = 1 AND P_PRODUCTO.ES_PROD_BARRA = 0 THEN D_BONIF_LOTES.PESO
	ELSE D_BONIF_LOTES.CANT END AS CANT, 
	CASE WHEN P_PRODUCTO.VENTA_POR_PESO = 1 AND P_PRODUCTO.ES_PROD_BARRA = 0 THEN D_BONIF_LOTES.PESO
	ELSE D_BONIF_LOTES.CANT END AS CANT2, D_BONIF_LOTES.LOTE, 0 AS BONIFICADO, 
	D_BONIF_LOTES.PRODUCTO AS PRODUCTO2, '' AS BARRA2, D_BONIF_LOTES.PESO, D_FACTURA.RUTA, 
	ISNULL(VENDEDORES.SUBBODEGA,'') AS GRUPO_VEND, ISNULL(VENDEDORES.NIVEL,0) AS NIVEL, '' AS MOTIVO, 
	1 AS Expr1, D_REL_PROD_BON.CONSECUTIVO AS POSICION, 
	D_REL_PROD_BON.CONSECUTIVO AS PADRE, CONVERT(INT, D_FACTURA.VEHICULO) AS CREDITO, '3000' AS SOCIEDAD, 
	'' AS CUENTA, ROUND(D_FACTURA.TOTAL, 2) AS TOTAL, D_FACTURA.REFERENCIA, D_FACTURA.SERIE, VENDEDORES.NOMBRE, D_FACTURA.CODIGOLIQUIDACION
	FROM         D_FACTURA AS D_FACTURA INNER JOIN
		P_VENDEDOR AS VENDEDORES ON D_FACTURA.VENDEDOR = VENDEDORES.CODIGO INNER JOIN
	D_REL_PROD_BON ON D_FACTURA.COREL = D_REL_PROD_BON.COREL INNER JOIN
	D_BONIF_LOTES ON D_REL_PROD_BON.COREL = D_BONIF_LOTES.COREL AND 
	D_REL_PROD_BON.BONIFICADO = D_BONIF_LOTES.PRODUCTO INNER JOIN P_PRODUCTO ON 
	P_PRODUCTO.CODIGO = D_BONIF_LOTES.PRODUCTO  
	WHERE     (D_FACTURA.ANULADO = N'N') AND CONVERT(INT, D_FACTURA.VEHICULO) = 1
	AND D_FACTURA.FECHA BETWEEN @FechaIni and @FechaFin AND  VENDEDORES.BODEGA = @Sucursal 
	UNION
	SELECT      D_FACTURA.STATCOM, ISNULL(VENDEDORES.BODEGA,'') AS OFI_VENTAS, D_FACTURA.FECHA, 
	D_FACTURA.SERIE + RIGHT('000000' + CONVERT(nvarchar(6), D_FACTURA.CORELATIVO), 6) AS COREL, D_FACTURA.COREL AS COREL1, 
	RIGHT ('0000000000' + D_FACTURA.CLIENTE,10) AS CLIENTE, 
	RIGHT ('0000000000' + D_FACTURA.CLIENTE,10) AS CLIENTE2, D_FACTURA.VENDEDOR, D_FACTURA.SUPERVISOR, D_FACTURA.AYUDANTE, 
	D_BONIF_BARRA.PRODUCTO, 
	D_BONIF_BARRA.PESO AS CANT, 1 AS CANT2, '' AS BARRA2, 1 AS BONIFICADO, D_BONIF_BARRA.PRODUCTO AS PRODUCTO2, D_BONIF_BARRA.BARRA, 
	D_BONIF_BARRA.PESO, D_FACTURA.RUTA, ISNULL(VENDEDORES.SUBBODEGA,'') AS GRUPO_VEND, ISNULL(VENDEDORES.NIVEL,0) AS NIVEL, 
	'' AS MOTIVO, 1 AS Expr1, D_REL_PROD_BON.CONSECUTIVO AS POSICION, D_REL_PROD_BON.CONSECUTIVO AS PADRE,
	CONVERT(INT, D_FACTURA.VEHICULO) AS CREDITO, '3000' AS SOCIEDAD, 
	D_DEPOS.BANCO AS CUENTA, ROUND(D_FACTURA.TOTAL, 2) AS TOTAL, D_FACTURA.REFERENCIA, D_FACTURA.SERIE, VENDEDORES.NOMBRE, D_FACTURA.CODIGOLIQUIDACION
	FROM         D_FACTURA AS D_FACTURA INNER JOIN
		P_VENDEDOR AS VENDEDORES ON D_FACTURA.VENDEDOR = VENDEDORES.CODIGO INNER JOIN
	D_REL_PROD_BON ON D_FACTURA.COREL = D_REL_PROD_BON.COREL INNER JOIN
	D_BONIF_BARRA ON D_REL_PROD_BON.COREL = D_BONIF_BARRA.COREL AND 
	D_REL_PROD_BON.BONIFICADO = D_BONIF_BARRA.PRODUCTO INNER JOIN
	D_DEPOSD ON D_DEPOSD.DOCCOREL = D_FACTURA.COREL INNER JOIN
	D_DEPOS ON D_DEPOSD.COREL = D_DEPOS.COREL
	WHERE     (D_FACTURA.ANULADO = N'N') AND D_FACTURA.FECHA BETWEEN @FechaIni and @FechaFin AND  VENDEDORES.BODEGA = @Sucursal 
	UNION
	SELECT      D_FACTURA.STATCOM, ISNULL(VENDEDORES.BODEGA,'') AS OFI_VENTAS, D_FACTURA.FECHA, 
	D_FACTURA.SERIE + RIGHT('000000' + CONVERT(nvarchar(6), D_FACTURA.CORELATIVO), 6) AS COREL, D_FACTURA.COREL AS COREL1, 
	RIGHT ('0000000000' + D_FACTURA.CLIENTE,10) AS CLIENTE, 
	RIGHT ('0000000000' + D_FACTURA.CLIENTE,10) AS CLIENTE2, D_FACTURA.VENDEDOR, D_FACTURA.SUPERVISOR, D_FACTURA.AYUDANTE, 
	D_BONIF_BARRA.PRODUCTO, 
	D_BONIF_BARRA.PESO AS CANT, 1 AS CANT2, '' AS BARRA2, 1 AS BONIFICADO, D_BONIF_BARRA.PRODUCTO AS PRODUCTO2, D_BONIF_BARRA.BARRA, 
	D_BONIF_BARRA.PESO, D_FACTURA.RUTA, ISNULL(VENDEDORES.SUBBODEGA,'') AS GRUPO_VEND, ISNULL(VENDEDORES.NIVEL,0) AS NIVEL, 
	'' AS MOTIVO, 1 AS Expr1, D_REL_PROD_BON.CONSECUTIVO AS POSICION, D_REL_PROD_BON.CONSECUTIVO AS PADRE, 
	CONVERT(INT, D_FACTURA.VEHICULO) AS CREDITO, '3000' AS SOCIEDAD, 
	'' AS CUENTA, ROUND(D_FACTURA.TOTAL, 2) AS TOTAL, D_FACTURA.REFERENCIA, D_FACTURA.SERIE, VENDEDORES.NOMBRE, D_FACTURA.CODIGOLIQUIDACION
	FROM         D_FACTURA AS D_FACTURA INNER JOIN
		P_VENDEDOR AS VENDEDORES ON D_FACTURA.VENDEDOR = VENDEDORES.CODIGO INNER JOIN
	D_REL_PROD_BON ON D_FACTURA.COREL = D_REL_PROD_BON.COREL INNER JOIN
	D_BONIF_BARRA ON D_REL_PROD_BON.COREL = D_BONIF_BARRA.COREL AND 
	D_REL_PROD_BON.BONIFICADO = D_BONIF_BARRA.PRODUCTO 
	WHERE     (D_FACTURA.ANULADO = N'N') AND CONVERT(INT, D_FACTURA.VEHICULO) = 1
	AND D_FACTURA.FECHA BETWEEN @FechaIni and @FechaFin AND  VENDEDORES.BODEGA = @Sucursal 

END
GO


