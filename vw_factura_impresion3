/****** Object:  View [dbo].[vw_factura_impresion3]    Script Date: 8/01/2023 23:17:15 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO



ALTER VIEW [dbo].[vw_factura_impresion3]
AS
SELECT        dbo.P_SUCURSAL.DESCRIPCION, dbo.P_SUCURSAL.DIRECCION, dbo.P_SUCURSAL.TELEFONO, dbo.P_SUCURSAL.NIT, dbo.D_FACTURA.COREL, 
                         dbo.D_FACTURA.CLIENTE AS CODIGOCLIENTE, dbo.P_CLIENTE.NOMBRE AS NOMBRECLIENTE, dbo.D_FACTURA.VENDEDOR AS CODIGOVENDEDOR, 
                         dbo.P_VENDEDOR.NOMBRE AS NOMBREVENDEDOR, dbo.D_FACTURAD.PRODUCTO AS CODIGOPRODUCTO, dbo.P_PRODUCTO.DESCCORTA AS NOMPRODUCTO, 
                         dbo.D_FACTURAD.CANT AS CANTIDAD, dbo.D_FACTURAD.PESO, dbo.D_FACTURAD.PRECIO, dbo.D_FACTURAD.TOTAL, 
                         CASE WHEN P_CLIENTE.MEDIAPAGO > '3' THEN 'CREDITO' ELSE 'CONTADO' END AS TIPO, 
                         CASE WHEN P_PRODUCTO.VENTA_POR_PESO = 0 THEN CASE WHEN P_PRODUCTO.ES_PROD_BARRA = 0 THEN D_FACTURAD.UMVenta ELSE D_FACTURAD.UMstock
                          END ELSE D_FACTURAD.UMstock END AS UM, dbo.D_FACTURA.FECHA, dbo.D_FACTURA.SERIE + RIGHT('000000' + CONVERT(NVARCHAR(6), 
                         dbo.D_FACTURA.CORELATIVO), 6) AS NOFACTURA, dbo.D_FACTURA.REFERENCIA, dbo.D_FACTURAD.UMVENTA, dbo.D_FACTURA.RUTA, dbo.D_FACTURA.ANULADO, 
                         dbo.D_FACTURA.ASIGNACION, dbo.D_FACTURA.FACTLINK, dbo.D_FACTURA.CODIGOLIQUIDACION, dbo.D_FACTURA.SERIE, dbo.D_FACTURA_CONTROL_CONTINGENCIA.QR, 
                         dbo.D_FACTURA_CONTROL_CONTINGENCIA.QRIMAGE, dbo.D_FACTURA_CONTROL_CONTINGENCIA.Cufe, P_SUCURSAL.TEXTO, P_CLIENTE.NIT AS NIT_CLIENTE, 
                  CASE WHEN dbo.P_CLIENTE.TIPORECEPTOR = '01' THEN 'Contribuyente' ELSE 'Consumidor final' END AS TIPORECEPTOR, P_CLIENTE.DIRECCION AS DIR_CLIENTE
FROM            dbo.P_SUCURSAL INNER JOIN
                         dbo.P_VENDEDOR INNER JOIN
                         dbo.D_FACTURA INNER JOIN
                         dbo.D_FACTURAD ON dbo.D_FACTURA.COREL = dbo.D_FACTURAD.COREL ON dbo.P_VENDEDOR.CODIGO = dbo.D_FACTURA.VENDEDOR INNER JOIN
                         dbo.P_CLIENTE ON dbo.D_FACTURA.CLIENTE = dbo.P_CLIENTE.CODIGO ON dbo.P_SUCURSAL.EMPRESA = dbo.D_FACTURA.EMPRESA AND 
                         dbo.P_SUCURSAL.CODIGO = dbo.P_CLIENTE.SUCURSAL INNER JOIN
                         dbo.P_PRODUCTO ON dbo.D_FACTURAD.PRODUCTO = dbo.P_PRODUCTO.CODIGO LEFT OUTER JOIN
                         dbo.D_FACTURA_CONTROL_CONTINGENCIA ON dbo.D_FACTURA.COREL = dbo.D_FACTURA_CONTROL_CONTINGENCIA.COREL AND dbo.D_FACTURA.VENDEDOR = dbo.D_FACTURA_CONTROL_CONTINGENCIA.VENDEDOR AND 
                         dbo.D_FACTURA.RUTA = dbo.D_FACTURA_CONTROL_CONTINGENCIA.RUTA


GO

