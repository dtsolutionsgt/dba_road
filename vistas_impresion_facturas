/****** Object:  View [dbo].[vw_factura_impresion3]    Script Date: 14-Mar-24 9:14:51 AM ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

ALTER VIEW [dbo].[vw_factura_impresion3]
AS
SELECT        dbo.P_SUCURSAL.DESCRIPCION, dbo.P_SUCURSAL.DIRECCION, dbo.P_SUCURSAL.TELEFONO, dbo.P_SUCURSAL.NIT, dbo.D_FACTURA.COREL, 
                         dbo.D_FACTURA.CLIENTE AS CODIGOCLIENTE, dbo.P_CLIENTE.NOMBRE AS NOMBRECLIENTE, dbo.D_FACTURA.VENDEDOR AS CODIGOVENDEDOR, 
                         dbo.P_VENDEDOR.NOMBRE AS NOMBREVENDEDOR, dbo.D_FACTURAD.PRODUCTO AS CODIGOPRODUCTO, dbo.P_PRODUCTO.DESCCORTA AS NOMPRODUCTO, 
                         dbo.D_FACTURAD.CANT AS CANTIDAD, dbo.D_FACTURAD.PESO, dbo.D_FACTURAD.PRECIO, dbo.D_FACTURAD.TOTAL, 
                         CASE WHEN P_CLIENTE.MEDIAPAGO > '3' THEN 'CREDITO' ELSE 'CONTADO' END AS TIPO, 
                         CASE WHEN P_PRODUCTO.VENTA_POR_PESO = 0 THEN CASE WHEN P_PRODUCTO.ES_PROD_BARRA = 0 THEN D_FACTURAD.UMVenta ELSE D_FACTURAD.UMstock
                          END ELSE D_FACTURAD.UMstock END AS UM, dbo.D_FACTURA.FECHA, dbo.D_FACTURA.SERIE + RIGHT('000000' + CONVERT(NVARCHAR(6), 
                         dbo.D_FACTURA.CORELATIVO), 6) AS NOFACTURA, dbo.D_FACTURA.REFERENCIA, dbo.D_FACTURAD.UMVENTA, dbo.D_FACTURA.RUTA, dbo.D_FACTURA.ANULADO, 
                         dbo.D_FACTURA.ASIGNACION, dbo.D_FACTURA.FACTLINK, dbo.D_FACTURA.CODIGOLIQUIDACION, dbo.D_FACTURA.SERIE, dbo.D_FACTURA_CONTROL_CONTINGENCIA.QR, 
                         dbo.D_FACTURA_CONTROL_CONTINGENCIA.QRIMAGE, dbo.D_FACTURA_CONTROL_CONTINGENCIA.Cufe, P_SUCURSAL.TEXTO, P_CLIENTE.NIT AS NIT_CLIENTE, 
                  CASE WHEN dbo.P_CLIENTE.TIPORECEPTOR = '01' THEN 'Contribuyente' ELSE 'Consumidor final' END AS TIPORECEPTOR, P_CLIENTE.DIRECCION AS DIR_CLIENTE,
				  dbo.D_FACTURA_CONTROL_CONTINGENCIA.CAJA, D_FACTURA_CONTROL_CONTINGENCIA.FECHA_AUTORIZACION, D_FACTURA_CONTROL_CONTINGENCIA.NUMERO_AUTORIZACION, 
				  ISNULL(D_FACTURA.ORDEN_COMPRA,'') ORDEN_COMPRA
FROM            dbo.P_SUCURSAL INNER JOIN
                         dbo.P_VENDEDOR INNER JOIN
                         dbo.D_FACTURA INNER JOIN
                         dbo.D_FACTURAD ON dbo.D_FACTURA.COREL = dbo.D_FACTURAD.COREL ON dbo.P_VENDEDOR.CODIGO = dbo.D_FACTURA.VENDEDOR INNER JOIN
                         dbo.P_CLIENTE ON dbo.D_FACTURA.CLIENTE = dbo.P_CLIENTE.CODIGO ON dbo.P_SUCURSAL.EMPRESA = dbo.D_FACTURA.EMPRESA AND 
                         dbo.P_SUCURSAL.CODIGO = dbo.P_CLIENTE.SUCURSAL INNER JOIN
                         dbo.P_PRODUCTO ON dbo.D_FACTURAD.PRODUCTO = dbo.P_PRODUCTO.CODIGO LEFT OUTER JOIN
                         dbo.D_FACTURA_CONTROL_CONTINGENCIA ON dbo.D_FACTURA.COREL = dbo.D_FACTURA_CONTROL_CONTINGENCIA.COREL AND dbo.D_FACTURA.VENDEDOR = dbo.D_FACTURA_CONTROL_CONTINGENCIA.VENDEDOR AND 
                         dbo.D_FACTURA.RUTA = dbo.D_FACTURA_CONTROL_CONTINGENCIA.RUTA


GO

/****** Object:  View [dbo].[vw_facturas_impresion4]    Script Date: 14-Mar-24 9:12:34 AM ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

ALTER VIEW [dbo].[vw_facturas_impresion4]
AS
SELECT        dbo.P_SUCURSAL.DESCRIPCION, dbo.P_SUCURSAL.DIRECCION, dbo.P_SUCURSAL.TELEFONO, dbo.P_SUCURSAL.NIT, dbo.D_FACTURA.COREL, 
                         dbo.D_FACTURA.CLIENTE AS CODIGOCLIENTE, ISNULL(dbo.P_CLIENTE.NOMBRE, N'CN') AS NOMBRECLIENTE, 
                         dbo.D_FACTURA.VENDEDOR AS CODIGOVENDEDOR, dbo.P_VENDEDOR.NOMBRE AS NOMBREVENDEDOR, dbo.D_FACTURAD.PRODUCTO AS CODIGOPRODUCTO, 
                         dbo.P_PRODUCTO.DESCCORTA AS NOMPRODUCTO, CASE WHEN P_PRODUCTO.ES_PROD_BARRA = 1 AND 
                         D_FACTURAD.UMVENTA <> 'KG' THEN D_FACTURAD.CANT * D_FACTURAD.FACTOR ELSE D_FACTURAD.CANT END AS CANTIDAD, dbo.D_FACTURAD.PESO, 
                         dbo.D_FACTURAD.PRECIO, dbo.D_FACTURAD.TOTAL, CASE WHEN D_FACTURA.VEHICULO = '0' THEN 'CONTADO' ELSE 'CREDITO' END AS TIPO, 
                         dbo.D_FACTURA.FECHA, dbo.D_FACTURA.SERIE + RIGHT('000000' + CONVERT(NVARCHAR(6), dbo.D_FACTURA.CORELATIVO), 6) AS NOFACTURA, 
                         dbo.D_FACTURA.REFERENCIA, dbo.D_FACTURA.ANULADO, ISNULL(CONVERT(INT, dbo.D_FACTURA.VEHICULO), 0) AS CREDITO, dbo.D_FACTURA.RUTA, 
                         CASE WHEN P_PRODUCTO.VENTA_POR_PESO = 0 THEN CASE WHEN P_PRODUCTO.ES_PROD_BARRA = 0 THEN D_FACTURAD.UMVenta ELSE D_FACTURAD.UMstock
                          END ELSE D_FACTURAD.UMstock END AS UM, dbo.D_FACTURA.ASIGNACION, dbo.D_FACTURA.FACTLINK, dbo.D_FACTURA.CODIGOLIQUIDACION, 
                         dbo.D_FACTURA.SERIE, ISNULL(D_FACTURA.ORDEN_COMPRA,'') ORDEN_COMPRA
FROM            dbo.D_FACTURA INNER JOIN
                         dbo.D_FACTURAD ON dbo.D_FACTURA.COREL = dbo.D_FACTURAD.COREL INNER JOIN
                         dbo.P_VENDEDOR ON dbo.P_VENDEDOR.CODIGO = dbo.D_FACTURA.VENDEDOR LEFT OUTER JOIN
                         dbo.P_CLIENTE ON dbo.D_FACTURA.CLIENTE = dbo.P_CLIENTE.CODIGO LEFT OUTER JOIN
                         dbo.P_SUCURSAL ON dbo.P_SUCURSAL.EMPRESA = dbo.D_FACTURA.EMPRESA AND dbo.P_SUCURSAL.CODIGO = dbo.P_CLIENTE.SUCURSAL INNER JOIN
                         dbo.P_PRODUCTO ON dbo.D_FACTURAD.PRODUCTO = dbo.P_PRODUCTO.CODIGO
GO

/****** Object:  View [dbo].[vw_facturas_impresion2]    Script Date: 14-Mar-24 9:11:58 AM ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

ALTER VIEW [dbo].[vw_facturas_impresion2]
AS
SELECT        ISNULL(dbo.P_SUCURSAL.DESCRIPCION, N'SD') AS DESCRIPCION, ISNULL(dbo.P_SUCURSAL.DIRECCION, N'SD') AS DIRECCION, 
                         ISNULL(dbo.P_SUCURSAL.TELEFONO, N'SD') AS TELEFONO, ISNULL(dbo.P_SUCURSAL.NIT, N'CF') AS NIT, dbo.D_FACTURA.COREL, 
                         dbo.D_FACTURA.CLIENTE AS CODIGOCLIENTE, dbo.P_CLIENTE.NOMBRE AS NOMBRECLIENTE, dbo.D_FACTURA.VENDEDOR AS CODIGOVENDEDOR, 
                         dbo.P_VENDEDOR.NOMBRE AS NOMBREVENDEDOR, dbo.D_FACTURAD.PRODUCTO AS CODIGOPRODUCTO, dbo.P_PRODUCTO.DESCCORTA AS NOMPRODUCTO, 
                         dbo.D_FACTURAD.CANT AS CANTIDAD, dbo.D_FACTURAD.PESO, dbo.D_FACTURAD.PRECIO, dbo.D_FACTURAD.TOTAL, 
                         CASE WHEN P_CLIENTE.MEDIAPAGO > '3' THEN 'CREDITO' ELSE 'CONTADO' END AS TIPO, dbo.D_FACTURA.FECHA, 
                         dbo.D_FACTURA.SERIE + RIGHT('000000' + CONVERT(NVARCHAR(6), dbo.D_FACTURA.CORELATIVO), 6) AS NOFACTURA, dbo.D_FACTURA.REFERENCIA, 
                         CASE WHEN P_PRODUCTO.VENTA_POR_PESO = 0 THEN CASE WHEN P_PRODUCTO.ES_PROD_BARRA = 0 THEN D_FACTURAD.UMVenta ELSE D_FACTURAD.UMstock
                          END ELSE D_FACTURAD.UMstock END AS UM, dbo.D_FACTURA.ASIGNACION, dbo.D_FACTURA.FACTLINK, dbo.D_FACTURA.ANULADO, dbo.D_FACTURA.RUTA, 
                         dbo.D_FACTURAD.COREL AS Expr1, ISNULL(D_FACTURA.ORDEN_COMPRA,'') ORDEN_COMPRA
FROM            dbo.D_FACTURA INNER JOIN
                         dbo.D_FACTURAD ON dbo.D_FACTURA.COREL = dbo.D_FACTURAD.COREL INNER JOIN
                         dbo.P_VENDEDOR ON dbo.P_VENDEDOR.CODIGO = dbo.D_FACTURA.VENDEDOR LEFT OUTER JOIN
                         dbo.P_CLIENTE ON dbo.D_FACTURA.CLIENTE = dbo.P_CLIENTE.CODIGO LEFT OUTER JOIN
                         dbo.P_SUCURSAL ON dbo.P_SUCURSAL.EMPRESA = dbo.D_FACTURA.EMPRESA AND dbo.P_SUCURSAL.CODIGO = dbo.P_CLIENTE.SUCURSAL INNER JOIN
                         dbo.P_PRODUCTO ON dbo.D_FACTURAD.PRODUCTO = dbo.P_PRODUCTO.CODIGO
GO

/****** Object:  View [dbo].[vw_facturas_impresion]    Script Date: 14-Mar-24 9:10:38 AM ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO




ALTER VIEW [dbo].[vw_facturas_impresion]
AS
SELECT        dbo.D_FACTURA.SERIE + RIGHT('000000' + CONVERT(NVARCHAR(6), dbo.D_FACTURA.CORELATIVO), 6) AS FACTURA, dbo.D_FACTURA.FECHA, 
                         dbo.D_FACTURA.CLIENTE + ' ' + ISNULL(dbo.P_CLIENTE.NOMBRE, N'CN') AS CLIENTE, 
                         CASE WHEN D_FACTURA.VEHICULO = '0' THEN 'CONTADO' ELSE 'CREDITO' END AS TIPO, CASE WHEN D_FACTURA.ANULADO = 'S' THEN ROUND(0, 2) 
                         ELSE SUM(ROUND(D_FACTURA.TOTAL, 2)) END AS TOTAL, dbo.D_FACTURA.RUTA + ' ' + dbo.P_RUTA.NOMBRE AS RUTA, dbo.P_VENDEDOR.CODIGO, 
                         dbo.P_VENDEDOR.NOMBRE, CASE WHEN D_FACTURA.ANULADO = 'S' THEN ROUND(0, 2) ELSE ISNULL(D_NOTACRED.TOTAL, 0) END AS TOTAL_NC, 
                         CASE WHEN D_FACTURA.ANULADO = 'S' THEN 0 ELSE ISNULL(D_NOTACRED.TOTAL, 0) END AS NOTA_CREDITO, 
                         CASE WHEN D_FACTURA.ANULADO = 'S' THEN 0 ELSE ROUND(SUM(D_FACTURA.TOTAL) - ISNULL(D_NOTACRED.TOTAL, 0), 2) END AS TOTAL_SIN_NC, 
                         dbo.D_FACTURA.ANULADO, D_FACTURA.CODIGOLIQUIDACION, D_FACTURA.VENDEDOR, DBO.P_RUTA.CODIGO AS CODIGORUTA, 
				  ISNULL(D_FACTURA.ORDEN_COMPRA,'') ORDEN_COMPRA
FROM            dbo.D_FACTURA INNER JOIN
                         dbo.P_RUTA ON dbo.D_FACTURA.RUTA = dbo.P_RUTA.CODIGO INNER JOIN
                         dbo.P_VENDEDOR ON dbo.D_FACTURA.VENDEDOR = dbo.P_VENDEDOR.CODIGO LEFT OUTER JOIN
                         dbo.P_CLIENTE ON dbo.D_FACTURA.CLIENTE = dbo.P_CLIENTE.CODIGO LEFT OUTER JOIN
                         dbo.D_NOTACRED ON dbo.D_FACTURA.COREL = dbo.D_NOTACRED.FACTURA
WHERE        (dbo.D_FACTURA.SERIE <> 'DL')
GROUP BY dbo.D_FACTURA.RUTA, dbo.P_RUTA.NOMBRE, dbo.P_VENDEDOR.CODIGO, dbo.P_VENDEDOR.NOMBRE, dbo.D_FACTURA.COREL, dbo.D_FACTURA.FECHA, 
                         dbo.D_FACTURA.CLIENTE, dbo.P_CLIENTE.NOMBRE, dbo.D_FACTURA.SERIE, dbo.D_FACTURA.CORELATIVO, dbo.D_NOTACRED.TOTAL, dbo.D_FACTURA.ANULADO, 
                         dbo.D_FACTURA.VEHICULO, D_FACTURA.CODIGOLIQUIDACION, D_FACTURA.VENDEDOR, DBO.P_RUTA.CODIGO, 
				         dbo.D_FACTURA.ORDEN_COMPRA



GO

/****** Object:  View [dbo].[vw_facturas_impresion5]    Script Date: 14-Mar-24 9:04:50 AM ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO


ALTER VIEW [dbo].[vw_facturas_impresion5]
AS
SELECT        dbo.P_SUCURSAL.DESCRIPCION, dbo.P_SUCURSAL.DIRECCION, dbo.P_SUCURSAL.TELEFONO, dbo.P_SUCURSAL.NIT, dbo.D_FACTURA.COREL, dbo.D_FACTURA.CLIENTE AS CODIGOCLIENTE, 
                         dbo.P_CLIENTE.NOMBRE AS NOMBRECLIENTE, dbo.D_FACTURA.VENDEDOR AS CODIGOVENDEDOR, dbo.P_VENDEDOR.NOMBRE AS NOMBREVENDEDOR, dbo.D_FACTURAD.PRODUCTO AS CODIGOPRODUCTO, 
                         dbo.P_PRODUCTO.DESCCORTA AS NOMPRODUCTO, dbo.D_FACTURAD.CANT AS CANTIDAD, dbo.D_FACTURAD.PESO, dbo.D_FACTURAD.PRECIO, dbo.D_FACTURAD.TOTAL, 
                         CASE WHEN P_CLIENTE.MEDIAPAGO > '3' THEN 'CREDITO' ELSE 'CONTADO' END AS TIPO, 
                         CASE WHEN P_PRODUCTO.VENTA_POR_PESO = 0 THEN CASE WHEN P_PRODUCTO.ES_PROD_BARRA = 0 THEN D_FACTURAD.UMVenta ELSE D_FACTURAD.UMstock END ELSE D_FACTURAD.UMstock END AS UM, 
                         dbo.D_FACTURA.FECHA, dbo.D_FACTURA.SERIE + RIGHT('000000' + CONVERT(NVARCHAR(6), dbo.D_FACTURA.CORELATIVO), 6) AS NOFACTURA, dbo.D_FACTURA.REFERENCIA, dbo.D_FACTURAD.UMVENTA, 
                         dbo.D_FACTURA.RUTA, dbo.D_FACTURA.ANULADO, dbo.D_FACTURA.ASIGNACION, dbo.D_FACTURA.FACTLINK, dbo.D_FACTURA.CODIGOLIQUIDACION, dbo.D_FACTURA.SERIE, dbo.D_FACTURA_CONTROL_CONTINGENCIA.QR, 
                         dbo.D_FACTURA_CONTROL_CONTINGENCIA.QRIMAGE, dbo.D_FACTURA_CONTROL_CONTINGENCIA.Cufe, P_SUCURSAL.TEXTO, P_CLIENTE.NIT AS NIT_CLIENTE, 
                  CASE WHEN dbo.P_CLIENTE.TIPORECEPTOR = '01' THEN 'Contribuyente' ELSE 'Consumidor final' END AS TIPORECEPTOR, P_CLIENTE.DIRECCION AS DIR_CLIENTE,
				  dbo.D_FACTURA_CONTROL_CONTINGENCIA.CAJA, D_FACTURA_CONTROL_CONTINGENCIA.FECHA_AUTORIZACION, D_FACTURA_CONTROL_CONTINGENCIA.NUMERO_AUTORIZACION, 
				  ISNULL(D_FACTURA.ORDEN_COMPRA,'') ORDEN_COMPRA
FROM            dbo.P_SUCURSAL INNER JOIN
                         dbo.P_VENDEDOR INNER JOIN
                         dbo.D_FACTURA INNER JOIN
                         dbo.D_FACTURAD ON dbo.D_FACTURA.COREL = dbo.D_FACTURAD.COREL ON dbo.P_VENDEDOR.CODIGO = dbo.D_FACTURA.VENDEDOR INNER JOIN
                         dbo.P_CLIENTE ON dbo.D_FACTURA.CLIENTE = dbo.P_CLIENTE.CODIGO ON dbo.P_SUCURSAL.EMPRESA = dbo.D_FACTURA.EMPRESA AND dbo.P_SUCURSAL.CODIGO = dbo.P_CLIENTE.SUCURSAL INNER JOIN
                         dbo.P_PRODUCTO ON dbo.D_FACTURAD.PRODUCTO = dbo.P_PRODUCTO.CODIGO LEFT OUTER JOIN
                         dbo.D_FACTURA_CONTROL_CONTINGENCIA ON dbo.D_FACTURA.COREL = dbo.D_FACTURA_CONTROL_CONTINGENCIA.COREL AND dbo.D_FACTURA.VENDEDOR = dbo.D_FACTURA_CONTROL_CONTINGENCIA.VENDEDOR AND 
                         dbo.D_FACTURA.RUTA = dbo.D_FACTURA_CONTROL_CONTINGENCIA.RUTA
GO







